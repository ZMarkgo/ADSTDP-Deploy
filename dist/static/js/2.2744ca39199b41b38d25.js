webpackJsonp([2],{Enb0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={name:"Analysis",components:{ScenarioUpload:i("P7ly").a},data:function(){return{analysis1:[],analysis0:[],analysis2:[],scenario_upload_visible:!1,scenario_select_visible:!1,dialogFormVisible:!1,accident_id:"",Afunction:[],form:{state:{id:"1",type:""},function:{id:"",type:""},analyzedScenario:{id:"",type:""},accidentFilePath:""},hasSubmitted:!1}},mounted:function(){this.loadAnalysisCases1(),this.loadAnalysisCases0(),this.loadAnalysisCases2(),this.showDialog()},methods:{showDialog:function(){"true"===this.$route.query.showDialog?this.dialogFormVisible=!0:this.dialogFormVisible=!1},loadAnalysisCases1:function(){var t=this;this.$axios.get("/analyzedcases/state/2").then(function(e){e&&200===e.data.code&&(t.analysis1=e.data.result)})},loadAnalysisCases0:function(){var t=this;this.$axios.get("/analyzedcases/state/1").then(function(e){e&&200===e.data.code&&(t.analysis0=e.data.result)})},loadAnalysisCases2:function(){var t=this;this.$axios.get("/analyzedcases/state/3").then(function(e){e&&200===e.data.code&&(t.analysis2=e.data.result)})},handleScenarioSelect:function(t){1==t&&(this.scenario_select_visible=!0,this.scenario_upload_visible=!1),2==t&&(this.scenario_select_visible=!1,this.scenario_upload_visible=!0)},handleScenarioSelectFromLibrary:function(){var t=this;console.log("test"),console.log(this.accident_id);var e=this;""===this.accident_id?this.$alert("请输入事故列表中具体事故场景的id","提示",{confirmButtonText:"确定"}):this.$axios.get("/accidents/searchbyid/"+this.accident_id).then(function(i){i&&200===i.data.code?(e.form.accidentFilePath=i.data.result,t.$alert("已找到该事故场景，请继续选择其他配置","提示",{confirmButtonText:"确定"})):(e.form.accidentFilePath="",t.$alert(i.data.result,"提示",{confirmButtonText:"确定"}))})},uploadScenario:function(){this.form.accidentFilePath=this.$refs.scenarioUpload.filePath},clearForm:function(){this.$refs.scenarioUpload.deleteUploadedFile(),this.scenario_select_visible=!1,this.scenario_upload_visible=!1,this.dialogFormVisible=!1,this.Afunction=[],this.accident_id="",this.form={state:{id:"1",type:""},function:{id:"",type:""},analyzedScenario:{id:"",type:""},accidentFilePath:""}},beforeCloseHandler:function(t){!1===this.hasSubmitted&&""!==this.$refs.scenarioUpload.filePath?this.$refs.scenarioUpload.deleteUploadedFile():(this.hasSubmitted=!1,this.clearForm()),t()},onSubmit:function(){var t=this;if(""===this.form.accidentFilePath)this.$alert("请先选择事故场景！如果您选择事故场景列表中的场景，您可能没有进行检索！如果您选择从本地上传事故场景，您可能没有点击上传按钮！","提示",{confirmButtonText:"确定"});else{for(var e=(new Date).toLocaleDateString(),i=0,a=0;a<this.Afunction.length;a++)i+=Number(this.Afunction[a]);this.form.function.id=i,this.$axios.post("/edit/analyzedcases",{date:e,state:this.form.state,function:this.form.function,analyzedScenario:this.form.analyzedScenario,accidentFilePath:this.form.accidentFilePath}).then(function(e){e&&200===e.data.code&&(t.dialogFormVisible=!1,t.hasSubmitted=!0,t.$router.go(0))})}},startAnalysis:function(t){var e=this;console.log(t+" 分析启动中"),this.$axios.post("/callscript/startanalysis",{id:t}).then(function(t){200===t.data.code?(e.$alert(t.data.message,"提示",{confirmButtonText:"确定调用成功"}),setTimeout(function(){e.$router.go(0)},3e3)):e.$alert(t.data.message,"提示",{confirmButtonText:"确定调用失败"})}).catch(function(t){console.log(t)})}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{"margin-top":"40px"}},[i("div",{staticClass:"AnalysisStarter"},[i("div",{staticClass:"button-container"},[i("el-button",{ref:"analysisStarter",staticClass:"button",on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("新建事故分析")])],1),t._v(" "),i("el-dialog",{attrs:{title:"请设置您需要的分析信息",visible:t.dialogFormVisible,"before-close":t.beforeCloseHandler},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("div",{staticStyle:{"text-align":"left"}},[t._v("分析场景:\n          "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.analyzedScenario.id,expression:"form.analyzedScenario.id"}],attrs:{type:"radio",value:"1"},domProps:{checked:t._q(t.form.analyzedScenario.id,"1")},on:{change:[function(e){return t.$set(t.form.analyzedScenario,"id","1")},function(e){return t.handleScenarioSelect(t.form.analyzedScenario.id)}]}}),t._v(" "),i("label",{attrs:{for:"从事故列表选取"}},[t._v("从事故列表选取")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.analyzedScenario.id,expression:"form.analyzedScenario.id"}],attrs:{type:"radio",value:"2"},domProps:{checked:t._q(t.form.analyzedScenario.id,"2")},on:{change:[function(e){return t.$set(t.form.analyzedScenario,"id","2")},function(e){return t.handleScenarioSelect(t.form.analyzedScenario.id)}]}}),t._v(" "),i("label",{attrs:{for:"点击上传"}},[t._v("点击上传")]),t._v(" "),i("scenario-upload",{directives:[{name:"show",rawName:"v-show",value:t.scenario_upload_visible,expression:"scenario_upload_visible"}],ref:"scenarioUpload",on:{onUpload:t.uploadScenario}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.scenario_select_visible,expression:"scenario_select_visible"}],staticClass:"scenario-select"},[t._v("\n            请输入事故场景ID： "),i("el-input",{model:{value:t.accident_id,callback:function(e){t.accident_id=e},expression:"accident_id"}}),t._v(" "),i("el-button",{on:{click:t.handleScenarioSelectFromLibrary}},[t._v("检索事故场景")])],1)],1),t._v(" "),i("div",{staticStyle:{"text-align":"left"}},[t._v("启用功能:\n          "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.Afunction,expression:"Afunction"}],attrs:{type:"checkbox",value:"10"},domProps:{checked:Array.isArray(t.Afunction)?t._i(t.Afunction,"10")>-1:t.Afunction},on:{change:function(e){var i=t.Afunction,a=e.target,s=!!a.checked;if(Array.isArray(i)){var n=t._i(i,"10");a.checked?n<0&&(t.Afunction=i.concat(["10"])):n>-1&&(t.Afunction=i.slice(0,n).concat(i.slice(n+1)))}else t.Afunction=s}}}),t._v(" "),i("label",{attrs:{for:"无关场景元素分析"}},[t._v("无关场景元素分析")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.Afunction,expression:"Afunction"}],attrs:{type:"checkbox",value:"1"},domProps:{checked:Array.isArray(t.Afunction)?t._i(t.Afunction,"1")>-1:t.Afunction},on:{change:function(e){var i=t.Afunction,a=e.target,s=!!a.checked;if(Array.isArray(i)){var n=t._i(i,"1");a.checked?n<0&&(t.Afunction=i.concat(["1"])):n>-1&&(t.Afunction=i.slice(0,n).concat(i.slice(n+1)))}else t.Afunction=s}}}),t._v(" "),i("label",{attrs:{for:"问题模块定位"}},[t._v("问题模块定位")])]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("添加事故分析")])],1)])],1),t._v(" "),i("div",{staticClass:"analysis-area"},[i("h1",[t._v(" 当前运行 ")]),t._v(" "),i("el-card",{staticStyle:{"text-align":"left",width:"98%"}},t._l(t.analysis1,function(e){return i("div",{key:e.id},[i("div",{staticStyle:{float:"left",width:"85%",height:"50px"}},[i("router-link",{staticClass:"detail-link",attrs:{to:{path:"/analysis/details",query:{id:e.id}}}},[i("span",{staticStyle:{"font-size":"20px"}},[i("strong",[t._v(" ID:"+t._s(e.id)+" ")])])]),t._v(" "),i("span",[t._v(" "+t._s(e.date)+" ")])],1)])}),0),t._v(" "),i("h1",[t._v(" 等待运行 ")]),t._v(" "),i("div",[i("el-row",t._l(t.analysis0,function(e){return i("el-col",{key:e.id,attrs:{span:8}},[i("el-card",{staticStyle:{"text-align":"left",width:"94%",height:"70%"}},[i("div",{staticStyle:{float:"left",width:"85%",height:"100px",display:"flex","flex-direction":"row"}},[i("div",[i("div",[i("span",{staticStyle:{"font-size":"20px"}},[i("strong",[t._v(" ID:"+t._s(e.id)+" ")])])]),t._v(" "),i("div",[i("span",[t._v(" "+t._s(e.date)+" ")])])]),t._v(" "),i("el-button",{staticStyle:{"margin-left":"40px",width:"100px",height:"50px"},on:{click:function(i){return t.startAnalysis(e.id)}}},[t._v("启动分析")])],1)])],1)}),1)],1),t._v(" "),i("h1",[t._v(" 运行结束 ")]),t._v(" "),i("div",[i("el-row",t._l(t.analysis2,function(e){return i("el-col",{key:e.id,attrs:{span:8}},[i("el-card",{staticStyle:{"text-align":"left",width:"94%",height:"70%"}},[i("div",{staticStyle:{float:"left",width:"85%",height:"100px"}},[i("span",{staticStyle:{"font-size":"20px"}},[i("strong",[t._v("ID:"+t._s(e.id))])]),t._v(" "),i("div",[i("span",[t._v(" "+t._s(e.date)+" ")])])])])],1)}),1)],1)],1)])},staticRenderFns:[]};var n=i("VU/8")(a,s,!1,function(t){i("eSQ9")},null,null);e.default=n.exports},P7ly:function(t,e,i){"use strict";var a={name:"ScenarioUpload",data:function(){return{myDialogVisible:!1,fileList:[],filePath:"",fileName:""}},methods:{handleExceed:function(t,e){var i="当前限制选择1个文件，本次选择了"+t.length+"个文件";t.length+e.length>=2&&(i=i+"，共选择了"+(t.length+e.length)+"个文件"),this.$alert(i,"提示",{confirmButtonText:"确定"})},deleteUploadedFile:function(){if(this.$refs.upload.uploadFiles.pop(),""!==this.filePath){var t=this.filePath.lastIndexOf("/"),e=this.filePath.substring(t+1),i=this;this.$axios.post("/scenarios/deleteuploadedfile",{fileName:e}).then(function(t){i.filePath="",i.fileList=[],i.fileName=""}).catch(function(t){console.log(t)})}},clear:function(){this.$refs.upload.clearFiles(),this.fileName=""},beforeUpload:function(t){var e="application/json"===t.type,i=t.size/1024/1024<5;return e||this.$alert("上传失败，仅支持上传json文件，请重新选择json格式的文件并上传！","提示",{confirmButtonText:"确定"}),i||this.$alert("上传失败，上传的文件大小不能超过5MB！","提示",{confirmButtonText:"确定"}),this.fileName=t.name,e&&i},submitUpload:function(t){var e=this,i=new FormData;i.append("file",t.file),this.$axios.post("/scenarios/upload",i).then(function(t){t&&200===t.data.code?(e.filePath=t.data.result,e.$alert("上传成功，该场景文件有效，请继续选择其他测试信息","提示",{confirmButtonText:"确定"}),e.$emit("onUpload"),e.myDialogVisible=!1):(e.$alert(t.data.message,"提示",{confirmButtonText:"确定"}),e.$refs.upload.uploadFiles.pop())})},submit:function(){this.$refs.upload.submit()},show:function(){this.myDialogVisible=!0},handleCancel:function(){this.myDialogVisible=!1,this.clear()},handleConfirm:function(){this.myDialogVisible=!1,this.$emit("onUpload")}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.myDialogVisible,expression:"myDialogVisible"}],staticClass:"dialog-mask"},[i("div",{staticClass:"dialog-container"},[i("div",{staticClass:"dialog-body"},[i("form",{staticClass:"modal"},[i("span",{staticClass:"close",on:{click:t.handleCancel}},[t._v("X")]),t._v(" "),i("div",{staticClass:"content"},[i("span",{staticClass:"title"},[t._v("上传场景文件")]),t._v(" "),i("p",{staticClass:"message"},[t._v("选择json格式的场景文件，点击上传可以检测场景文件是否有效")]),t._v(" "),i("el-upload",{ref:"upload",staticClass:"button upload-btn",attrs:{action:"http://localhost:8443/api/scenarios/upload","http-request":t.submitUpload,accept:"application/json","before-remove":t.deleteUploadedFile,multiple:"",limit:1,"on-exceed":t.handleExceed,"file-list":t.fileList,"before-upload":t.beforeUpload,"auto-upload":!1}},[i("div",{staticClass:"button-container"},[i("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),t._v(" "),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submit}},[t._v("确定")])],1),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传json文件")])])],1)])])])])])},staticRenderFns:[]};var n=i("VU/8")(a,s,!1,function(t){i("fNC4")},"data-v-4a210710",null);e.a=n.exports},eSQ9:function(t,e){},fNC4:function(t,e){}});
//# sourceMappingURL=2.2744ca39199b41b38d25.js.map